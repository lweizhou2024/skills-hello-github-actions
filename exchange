% Create some sample data
x = 0:0.1:10;
y = sin(x);

% Create a figure and axes
fig = figure;
ax = axes('Parent', fig, 'Position', [0.1 0.2 0.8 0.7]); % Adjust position as needed
plot(ax, x, y);
title('Plot with X-Axis Panning Slider (Continuous Update)');

% Set initial x-axis limits
xmin_initial = min(x);
xmax_initial = max(x);
xlim(ax, [xmin_initial xmax_initial]);

% Get the initial width of the displayed x-axis
current_xlim_width = xmax_initial - xmin_initial;

% Define the full range of your data for the slider's min and max
data_min_x = min(x);
data_max_x = max(x);

% The slider's minimum value should be the absolute minimum of your data
slider_min_val = data_min_x;

% The slider's maximum value should be the point where the left edge of the
% viewable window is such that the right edge of the window aligns with data_max_x.
slider_max_val = data_max_x - current_xlim_width;

% If the initial window covers the entire data range or more,
% the slider_max_val might be less than slider_min_val.
% In such a case, adjust slider_max_val to be at least slider_min_val.
if slider_max_val < slider_min_val
    slider_max_val = slider_min_val; % Disables panning if viewable window is full data range
end

% Set the initial value of the slider to the current xmin
slider_initial_value = xmin_initial;

% Calculate the slider step. These are normalized steps between 0 and 1.
slider_range = slider_max_val - slider_min_val;

if slider_range == 0
    minor_step = 0.1;
    major_step = 0.1;
else
    % A step size that is, for example, 1% of the visible window
    minor_step = (current_xlim_width / 100) / slider_range;
    % A large step could be 10% of the visible window
    major_step = (current_xlim_width / 10) / slider_range;

    % Ensure step values are valid (between 0 and 1, and minor <= major)
    minor_step = max(0, min(1, minor_step));
    major_step = max(0, min(1, major_step));
    if minor_step > major_step
        major_step = minor_step; % Ensure major is not smaller than minor
    end
    if minor_step == 0 && slider_range > 0 % Fallback if minor_step became 0 but range exists
        minor_step = 0.001; % Very small default
    end
    if major_step == 0 && slider_range > 0
        major_step = 0.01; % Small default
    end
end


% Define the position of the slider [left bottom width height]
slider_position = [0.1 0.05 0.8 0.05];

sld = uicontrol('Parent', fig, ...
    'Style', 'slider', ...
    'Units', 'normalized', ...
    'Position', slider_position, ...
    'min', slider_min_val, ...
    'max', slider_max_val, ...
    'Value', slider_initial_value, ...
    'SliderStep', [minor_step major_step]); % Removed Callback from here

% --- IMPORTANT CHANGE: Add a listener for continuous updates ---
addlistener(sld, 'Value', 'PostSet', @(es, ed) updateXlim(ax, es.Value, current_xlim_width));

% Callback function to update the x-axis limits
function updateXlim(ax, new_xmin, window_width)
    % new_xmin is the value of the slider, which will be our new lower x-limit
    new_xmax = new_xmin + window_width;
    xlim(ax, [new_xmin new_xmax]);
end
