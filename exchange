% ScreenCapture_Optris.m
% Capture full screen periodically and save to video

% --- user settings ---
outputFile = 'screen_capture.mp4';   % output video filename
numFrames = 30;                      % total frames to capture
captureInterval = 10;                % seconds between captures (your RAVI rate)
videoFrameRate = 1;                  % playback rate in output video (1 frame/sec)
startDelay = 10;                     % seconds to wait before first capture
% ----------------------

disp('Starting screen capture...');
disp(['Waiting ', num2str(startDelay), ' seconds so you can start PIX playback...']);
pause(startDelay);

% Create video writer
v = VideoWriter(outputFile, 'MPEG-4');
v.FrameRate = videoFrameRate;
open(v);

% Get screen size
set(0,'Units','pixels');
screenSize = get(0,'ScreenSize');
width = screenSize(3);
height = screenSize(4);

% Use Java Robot to capture screen (faster than getframe)
robot = java.awt.Robot();

for i = 1:numFrames
    % Capture current screen
    img = robot.createScreenCapture(java.awt.Rectangle(width, height));
    rgb = typecast(img.getData().getDataStorage(), 'uint8');
    rgb = reshape(rgb, [3, width, height]);
    frame = cat(3, ...
        rot90(reshape(rgb(3,:,:), [width, height])', -1), ...
        rot90(reshape(rgb(2,:,:), [width, height])', -1), ...
        rot90(reshape(rgb(1,:,:), [width, height])', -1));
    
    % Write frame to video
    writeVideo(v, im2frame(frame));
    disp(['Captured frame ', num2str(i), ' of ', num2str(numFrames)]);
    
    % Wait for next capture
    if i < numFrames
        pause(captureInterval);
    end
end

close(v);
disp(['Done! Video saved as ', outputFile]);
